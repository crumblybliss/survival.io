<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - CrumblyBliss</title>
    <link rel="manifest" href="data:application/json,{%22name%22:%22CrumblyBliss%22,%22short_name%22:%22CrumblyBliss%22,%22start_url%22:%22index.html%22,%22display%22:%22standalone%22,%22background_color%22:%22#0a1d37%22,%22theme_color%22:%22#00bcd4%22,%22icons%22:[{%22src%22:%22icon-192.png%22,%22sizes%22:%22192x192%22,%22type%22:%22image/png%22},{%22src%22:%22icon-512.png%22,%22sizes%22:%22512x512%22,%22type%22:%22image/png%22}]}" />
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("sw.js")
                .then(() => console.log("Service Worker Registered"))
                .catch((error) => console.log("Service Worker Registration Failed:", error));
        }
    </script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #0a1d37;
            color: #f1f1f1;
            text-align: center;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
        }

        .install-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #00bcd4;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Welcome to CrumblyBliss</h1>
        <p>Delicious treats and survival gear!</p>
    </div>

    <!-- Install App Button -->
    <button id="install-button" class="install-button">Install App</button>

    <script>
        let deferredPrompt;
        window.addEventListener("beforeinstallprompt", (event) => {
            event.preventDefault();
            deferredPrompt = event;
            document.getElementById("install-button").style.display = "block";
        });

        document.getElementById("install-button").addEventListener("click", () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("User accepted the install prompt");
                    }
                    deferredPrompt = null;
                });
            }
        });

        window.addEventListener("appinstalled", () => {
            document.getElementById("install-button").style.display = "none";
        });
    </script>

    <!-- Inline Service Worker -->
    <script id="sw">
        const CACHE_NAME = "CrumblyBliss-v1";
        const ASSETS_TO_CACHE = [
            "index.html"
        ];

        self.addEventListener("install", (event) => {
            event.waitUntil(
                caches.open(CACHE_NAME).then((cache) => {
                    return cache.addAll(ASSETS_TO_CACHE);
                })
            );
        });

        self.addEventListener("activate", (event) => {
            event.waitUntil(
                caches.keys().then((keys) => {
                    return Promise.all(
                        keys.filter((key) => key !== CACHE_NAME).map((key) => caches.delete(key))
                    );
                })
            );
        });

        self.addEventListener("fetch", (event) => {
            event.respondWith(
                caches.match(event.request).then((response) => {
                    return response || fetch(event.request);
                }).catch(() => caches.match("index.html"))
            );
        });
    </script>

</body>
</html>
