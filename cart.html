<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bracelets & Cookies Shop</title>
<style>
  /* Reset & Base */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fef6f0; padding: 20px; color: #333; }

  h1 { font-size: 2.8rem; text-align: center; color: #FF7F50; margin-bottom: 30px; }
  h2 { font-size: 1.6rem; margin-bottom: 20px; color: #333; }

  /* Sections */
  .section { background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); margin-bottom: 30px; transition: transform 0.2s; }
  .section:hover { transform: translateY(-2px); }

  /* Inputs & Buttons */
  input, select, button { font-size: 1rem; padding: 12px; border-radius: 8px; border: 1px solid #ccc; }
  input, select { width: 100%; margin-bottom: 15px; }
  button { cursor: pointer; background: #FF7F50; color: #fff; border: none; transition: 0.3s; width: 100%; margin-top: 10px; }
  button:hover { background: #FF4500; }

  .removeBtn { background: #dc3545; margin-left: 10px; width: auto; }
  .removeBtn:hover { background: #a71d2a; }

  /* Cart List */
  ul { list-style: none; padding: 0; }
  li { background: #fff3e0; margin-bottom: 15px; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
  li:hover { background: #ffe5cc; }
  .item-info { display: flex; flex-direction: column; gap: 10px; }
  .item-info div { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }

  /* Labels & badges */
  .badge { background: #FF7F50; color: #fff; padding: 2px 6px; border-radius: 5px; font-size: 0.8rem; }

  /* Responsive */
  @media (min-width: 600px) {
    #login-section input, #login-section select, #login-section button { width: auto; display: inline-block; }
    .item-info { flex-direction: row; gap: 20px; }
  }
</style>
</head>
<body>

<h1>Bracelets & Cookies Shop</h1>

<div id="login-section" class="section">
  <h2>Login / Sign Up</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <button id="signupBtn">Sign Up</button>
</div>

<div id="cart-section" class="section" style="display:none;">
  <h2>Your Cart</h2>
  <ul id="cart-list"></ul>
  <button id="checkoutBtn">Checkout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";
import { getFirestore, collection, getDocs, addDoc, doc, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCrdPP5q_eZ4OqqcCW1nguD89f5VHLPVU0",
  authDomain: "survival-f35e2.firebaseapp.com",
  projectId: "survival-f35e2",
  storageBucket: "survival-f35e2.appspot.com",
  messagingSenderId: "704462603548",
  appId: "1:704462603548:android:00d1a3fb89f9106a59e6d9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const loginSection = document.getElementById("login-section");
const cartSection = document.getElementById("cart-section");
const cartList = document.getElementById("cart-list");
const loginBtn = document.getElementById("loginBtn");
const signupBtn = document.getElementById("signupBtn");
const checkoutBtn = document.getElementById("checkoutBtn");

let userUID = null;
let unsubscribeCart = null;

// Login
loginBtn.addEventListener("click", () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  signInWithEmailAndPassword(auth, email, password).catch(err => alert(err.message));
});

// Sign Up
signupBtn.addEventListener("click", () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  createUserWithEmailAndPassword(auth, email, password).catch(err => alert(err.message));
});

// Auth State
onAuthStateChanged(auth, user => {
  if (user) {
    userUID = user.uid;
    loginSection.style.display = "none";
    cartSection.style.display = "block";
    loadCartRealtime();
  } else {
    userUID = null;
    loginSection.style.display = "block";
    cartSection.style.display = "none";
    if (unsubscribeCart) unsubscribeCart();
  }
});

// Load Cart Real-time
function loadCartRealtime() {
  const userCartRef = collection(db, "carts");
  if (unsubscribeCart) unsubscribeCart();

  unsubscribeCart = onSnapshot(userCartRef, snapshot => {
    cartList.innerHTML = "";
    snapshot.forEach(docSnap => {
      const data = docSnap.data();
      if (data.uid !== userUID) return;

      const li = document.createElement("li");
      li.innerHTML = `
        <div class="item-info">
          <strong>${data.productName}</strong>
          <div>
            ${data.type === 'bracelet' 
              ? `Color: <input type="color" value="${data.color || '#ffffff'}" data-id="${docSnap.id}" class="color"> Size: 
              <select data-id="${docSnap.id}" class="size">
                <option value="small" ${data.size==='small'?'selected':''}>Small</option>
                <option value="medium" ${data.size==='medium'?'selected':''}>Medium</option>
                <option value="large" ${data.size==='large'?'selected':''}>Large</option>
              </select>` 
              : `Flavor: <input type="text" value="${data.flavor || ''}" data-id="${docSnap.id}" class="flavor">`
            }
          </div>
        </div>
        <button data-id="${docSnap.id}" class="removeBtn">Remove</button>
      `;
      cartList.appendChild(li);
    });

    document.querySelectorAll(".color").forEach(input => {
      input.addEventListener("input", e => updateDoc(doc(db, "carts", e.target.dataset.id), { color: e.target.value }));
    });
    document.querySelectorAll(".size").forEach(select => {
      select.addEventListener("change", e => updateDoc(doc(db, "carts", e.target.dataset.id), { size: e.target.value }));
    });
    document.querySelectorAll(".flavor").forEach(input => {
      input.addEventListener("input", e => updateDoc(doc(db, "carts", e.target.dataset.id), { flavor: e.target.value }));
    });
    document.querySelectorAll(".removeBtn").forEach(btn => {
      btn.addEventListener("click", e => deleteDoc(doc(db, "carts", e.target.dataset.id)));
    });
  });
}

// Checkout
checkoutBtn.addEventListener("click", async () => {
  const snapshot = await getDocs(collection(db, "carts"));
  const orders = [];

  snapshot.forEach(docSnap => {
    const data = docSnap.data();
    if (data.uid !== userUID) return;
    orders.push({
      productName: data.productName,
      type: data.type,
      color: data.color || null,
      size: data.size || null,
      flavor: data.flavor || null,
      uid: userUID,
      timestamp: new Date()
    });
  });

  for (const order of orders) {
    await addDoc(collection(db, "orders"), order);
  }

  alert("Order placed!");
});
</script>

</body>
</html>
