<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Manage Products</title>
  <script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.8.0/firebase-firestore.js"></script>
</head>
<body>
  <h1>Admin Panel - Product Management</h1>

  <!-- Add Product Form -->
  <div id="product-form">
    <h2>Add Product</h2>
    <form id="add-product-form">
      <label for="productName">Product Name:</label>
      <input type="text" id="productName" required>
      <br>

      <label for="productPrice">Product Price:</label>
      <input type="number" id="productPrice" required>
      <br>

      <button type="button" onclick="addProduct()">Add Product</button>
    </form>
  </div>

  <hr>

  <!-- Display Product List -->
  <div id="product-list">
    <h2>Product List</h2>
    <table id="productsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>Price</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script type="module">
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCrdPP5q_eZ4OqqcCW1nguD89f5VHLPVU0",
      authDomain: "survival-f35e2.firebaseapp.com",
      projectId: "survival-f35e2",
      storageBucket: "survival-f35e2.appspot.com",
      messagingSenderId: "704462603548",
      appId: "1:704462603548:android:00d1a3fb89f9106a59e6d9"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);

    // Add Product Function
    function addProduct() {
      const productName = document.getElementById("productName").value;
      const productPrice = document.getElementById("productPrice").value;

      if (!productName || !productPrice) {
        alert("Please fill in all fields");
        return;
      }

      const productData = {
        name: productName,
        price: parseFloat(productPrice),
        timestamp: new Date(),
      };

      db.collection("products").add(productData)
        .then(() => {
          alert("Product added successfully!");
          fetchProducts();  // Refresh the product list
          document.getElementById("add-product-form").reset();
        })
        .catch((error) => {
          console.error("Error adding product: ", error);
          alert("Error adding product");
        });
    }

    // Fetch and display products
    function fetchProducts() {
      db.collection("products").get()
        .then((snapshot) => {
          const productsTable = document.getElementById("productsTable").getElementsByTagName('tbody')[0];
          productsTable.innerHTML = "";  // Clear the table first

          snapshot.forEach(doc => {
            const product = doc.data();
            const row = productsTable.insertRow();
            row.setAttribute('data-id', doc.id);  // Store the document ID for later

            row.insertCell(0).textContent = product.name;
            row.insertCell(1).textContent = `$${product.price.toFixed(2)}`;

            // Edit and Delete buttons
            const actionsCell = row.insertCell(2);
            actionsCell.innerHTML = `
              <button onclick="editProduct('${doc.id}')">Edit</button>
              <button onclick="deleteProduct('${doc.id}')">Delete</button>
            `;
          });
        })
        .catch((error) => {
          console.error("Error fetching products: ", error);
          alert("Error fetching products");
        });
    }

    // Edit Product
    function editProduct(id) {
      const productRef = db.collection("products").doc(id);
      
      productRef.get()
        .then((doc) => {
          if (doc.exists) {
            const product = doc.data();
            const newName = prompt("Edit Product Name:", product.name);
            const newPrice = prompt("Edit Product Price:", product.price);

            if (newName && newPrice) {
              productRef.update({
                name: newName,
                price: parseFloat(newPrice),
              })
              .then(() => {
                alert("Product updated successfully!");
                fetchProducts();  // Refresh the product list
              })
              .catch((error) => {
                console.error("Error updating product: ", error);
                alert("Error updating product");
              });
            }
          }
        })
        .catch((error) => {
          console.error("Error fetching product: ", error);
          alert("Error fetching product");
        });
    }

    // Delete Product
    function deleteProduct(id) {
      const confirmation = confirm("Are you sure you want to delete this product?");
      if (confirmation) {
        db.collection("products").doc(id).delete()
          .then(() => {
            alert("Product deleted successfully!");
            fetchProducts();  // Refresh the product list
          })
          .catch((error) => {
            console.error("Error deleting product: ", error);
            alert("Error deleting product");
          });
      }
    }

    // Fetch products when the page loads
    fetchProducts();
  </script>

</body>
</html>
