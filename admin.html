<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <style>
        .product-card {
            border: 1px solid #ddd;
            padding: 16px;
            margin: 8px;
            display: inline-block;
            width: 200px;
            text-align: center;
        }
        .product-card img {
            width: 100%;
            height: auto;
        }
        .product-card button {
            background-color: red;
            color: white;
            padding: 8px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>

<h1>Admin Dashboard</h1>

<div id="product-list"></div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
<script>
  // Firebase Configuration
  const firebaseConfig = {
    apiKey: 'YOUR_API_KEY',
    authDomain: 'YOUR_AUTH_DOMAIN',
    projectId: 'YOUR_PROJECT_ID',
    storageBucket: 'YOUR_STORAGE_BUCKET',
    messagingSenderId: 'YOUR_MESSAGING_SENDER_ID',
    appId: 'YOUR_APP_ID'
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // Authentication check
  auth.onAuthStateChanged((user) => {
    if (!user) {
      alert("You must be logged in to access the admin panel.");
      window.location.href = "/login.html"; // Redirect to login page
    } else if (user && !user.customClaims?.role === 'admin') {
      alert("You do not have admin privileges.");
      window.location.href = "/"; // Redirect to homepage
    } else {
      loadProducts(); // Load products if user is admin
    }
  });

  // Load products from Firestore
  async function loadProducts() {
    const container = document.getElementById('product-list');
    container.innerHTML = '';

    try {
      const querySnapshot = await getDocs(collection(db, 'products'));
      querySnapshot.forEach((doc) => {
        const product = doc.data();

        const card = document.createElement('div');
        card.className = 'product-card';

        const img = document.createElement('img');
        img.src = product.image || 'fallback.jpg'; // Use fallback image if missing
        img.alt = product.name;
        img.onerror = () => { img.src = 'fallback.jpg'; }; // Fallback if image not found

        const title = document.createElement('h3');
        title.textContent = product.name;

        const price = document.createElement('p');
        price.textContent = `$${product.price}`;

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Delete';
        deleteBtn.onclick = () => deleteProduct(doc.id);

        card.appendChild(img);
        card.appendChild(title);
        card.appendChild(price);
        card.appendChild(deleteBtn);

        container.appendChild(card);
      });
    } catch (error) {
      console.error('Error loading products:', error);
      alert('Failed to load products.');
    }
  }

  // Delete product from Firestore
  async function deleteProduct(productId) {
    try {
      await deleteDoc(doc(db, 'products', productId));
      alert("Product deleted successfully");
      loadProducts(); // Reload products
    } catch (error) {
      console.error('Error deleting product:', error);
      alert('Failed to delete product.');
    }
  }
</script>

</body>
</html>
